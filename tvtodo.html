<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹¤ì‹œê°„ ì§‘ì•ˆì¼ í˜„í™©íŒ</title>
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --point-color: #58a6ff;
            --text-color: #ffffff;
            --focus-color: #f0ad4e; /* ì„ íƒ ì‹œ ê°•ì¡° ìƒ‰ìƒ */
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Malgun Gothic', sans-serif;
            padding: 50px;
            margin: 0;
            overflow: hidden;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 5px solid var(--point-color);
            padding-bottom: 20px;
            margin-bottom: 50px;
        }
        .header h1 { font-size: 80px; margin: 0; }
        .clock { font-size: 50px; color: var(--point-color); font-weight: bold; }

        .todo-list { display: grid; grid-template-columns: 1fr; gap: 25px; }
        
        /* ë¦¬ëª¨ì»¨ í¬ì»¤ìŠ¤ë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ */
        .todo-item {
            background-color: var(--card-bg);
            padding: 40px 60px;
            border-radius: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 15px solid var(--point-color);
            transition: 0.2s;
            cursor: pointer;
        }
        .todo-item:focus {
            border: 6px solid var(--focus-color);
            transform: scale(1.03);
            outline: none;
            background-color: #21262d;
        }
        .todo-title { font-size: 55px; font-weight: bold; }
        .todo-btn {
            font-size: 30px;
            background: #238636;
            padding: 10px 30px;
            border-radius: 50px;
            font-weight: bold;
        }
        .empty { font-size: 50px; text-align: center; color: #8b949e; margin-top: 100px; }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ“‹ ì§‘ì•ˆì¼ ëŒ€ê¸° ëª…ë‹¨</h1>
    <div class="clock" id="clock">00:00:00</div>
</div>

<div id="todo-list" class="todo-list"></div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbx9NQ2z6H812TyORIe8EmO55kWiHmVJXV_e7OdGLc95f4OiMhvm30o2h_5UbP4N2wqs9w/exec";

    // ì‹œê°„ ì—…ë°ì´íŠ¸
    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('ko-KR', {hour12:false});
    }, 1000);

    // í•  ì¼ ë¶ˆëŸ¬ì˜¤ê¸°
    async function fetchTasks() {
        try {
            const res = await fetch(GAS_URL);
            const data = await res.json();
            const list = document.getElementById('todo-list');
            list.innerHTML = data.length ? '' : '<div class="empty">ëª¨ë“  í•  ì¼ì„ ë§ˆì³¤ìŠµë‹ˆë‹¤! ğŸ‰</div>';

            data.slice(0, 5).forEach((task, idx) => {
                const item = document.createElement('div');
                item.className = 'todo-item';
                item.tabIndex = 0; // ë¦¬ëª¨ì»¨ í¬ì»¤ìŠ¤ í—ˆìš©
                item.innerHTML = `<div class="todo-title">${task.title}</div><div class="todo-btn">í™•ì¸ì‹œ ì™„ë£Œ</div>`;
                
                // í´ë¦­ ë˜ëŠ” ë¦¬ëª¨ì»¨ ì—”í„°í‚¤ ì´ë²¤íŠ¸
                const complete = () => markAsDone(task.id);
                item.onclick = complete;
                item.onkeydown = (e) => { if(e.key === 'Enter') complete(); };
                
                list.appendChild(item);
                if(idx === 0) item.focus(); // ì²« ë²ˆì§¸ í•­ëª©ì— ìë™ í¬ì»¤ìŠ¤
            });
        } catch(e) { console.error(e); }
    }
    async function markAsDone(taskId) {
        if(!confirm("ì´ í•­ëª©ì„ ì™„ë£Œ ì²˜ë¦¬í• ê¹Œìš”?")) return;
        
        try {
            // GAS URL ë’¤ì— íŒŒë¼ë¯¸í„°ë¥¼ ë¶™ì—¬ì„œ ë³´ë‚´ëŠ” ê²ƒì´ ê°€ì¥ í™•ì‹¤í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤.
            const response = await fetch(GAS_URL, {
                method: 'POST',
                mode: 'no-cors', // CORS ì •ì±…ìœ¼ë¡œ ì¸í•œ ì°¨ë‹¨ ë°©ì§€
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ taskId: taskId })
            });
    
            // no-cors ëª¨ë“œì—ì„œëŠ” ì‘ë‹µ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ 
            // ì•½ê°„ì˜ ì‹œê°„ì°¨(0.5ì´ˆ)ë¥¼ ë‘ê³  ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
            setTimeout(() => {
                fetchTasks(); 
            }, 500);
    
        } catch(e) { 
            console.error("ì—°ê²° ì—ëŸ¬:", e);
            alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    fetchTasks();
    setInterval(fetchTasks, 60000); // 1ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
</script>
</body>
</html>
