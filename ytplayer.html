<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Player</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: transparent;
            font-family: 'Inter', sans-serif;
            color: #1f2937;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to the top for a better mobile view */
            padding-top: 2rem;
            min-height: 100vh;
        }
        .container {
            @apply flex flex-col items-center p-6 bg-white bg-opacity-80 rounded-3xl shadow-2xl backdrop-blur-sm border border-gray-200 w-full max-w-sm;
        }
        .title {
            @apply text-xl font-bold mb-4 text-center text-gray-800;
        }
        .input-container {
            @apply w-full mb-4;
        }
        .link-input {
            @apply w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors;
        }
        .control-btn {
            @apply px-4 py-2 m-1 font-semibold rounded-full shadow-lg transition-transform transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2;
            cursor: pointer;
        }
        #player-container {
            @apply mt-4 w-full flex justify-center items-center;
            min-height: 200px; /* Ensures space for the player */
        }
        #youtube-player {
            @apply w-full aspect-video;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .error-message {
            @apply text-red-500 text-sm mt-2 text-center;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="title">유튜브 라디오 플레이어</div>
    <div class="input-container">
        <input type="text" id="youtube-link" class="link-input" placeholder="여기에 유튜브 링크를 붙여넣으세요">
        <div id="error-message" class="error-message hidden">유효하지 않은 유튜브 링크입니다.</div>
    </div>
    
    <div class="flex flex-wrap justify-center mb-4">
        <button id="load-btn" class="control-btn bg-blue-500 text-white hover:bg-blue-600 focus:ring-blue-500">불러오기</button>
        <button id="play-btn" class="control-btn bg-green-500 text-white hover:bg-green-600 focus:ring-green-500 hidden">재생</button>
        <button id="pause-btn" class="control-btn bg-red-500 text-white hover:bg-red-600 focus:ring-red-500 hidden">일시정지</button>
    </div>

    <div id="player-container">
        <!-- The YouTube iframe will be inserted here -->
    </div>
</div>

<script>
    // YouTube IFrame Player API를 비동기적으로 로드합니다.
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // HTML 요소 가져오기
    const youtubeLinkInput = document.getElementById('youtube-link');
    const loadBtn = document.getElementById('load-btn');
    const playBtn = document.getElementById('play-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const playerContainer = document.getElementById('player-container');
    const errorMessage = document.getElementById('error-message');

    // YouTube Player 객체 변수
    let player;
    let videoId = null;

    // 유튜브 API 로드 후 실행되는 함수
    function onYouTubeIframeAPIReady() {
        // 플레이어를 즉시 생성하지 않고, 버튼 클릭 시 생성하도록 합니다.
        console.log("YouTube API is ready.");
    }

    // 유튜브 링크에서 비디오 ID를 추출하는 함수
    function extractVideoId(url) {
        if (!url) return null;
        let regExp = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
        let match = url.match(regExp);
        return (match && match[1].length === 11) ? match[1] : null;
    }

    // 플레이어를 생성하고 로드하는 함수
    function createPlayer(id) {
        // 기존 플레이어가 있으면 제거
        if (player) {
            player.destroy();
            player = null;
        }

        playerContainer.innerHTML = ''; // 기존 iframe 제거

        player = new YT.Player('player-container', {
            videoId: id,
            playerVars: {
                'controls': 1, // 플레이어 컨트롤바 표시
                'modestbranding': 1, // 유튜브 로고 간소화
                'rel': 0, // 관련 동영상 표시 안 함
                'iv_load_policy': 3, // 동영상 내 주석 숨기기
                'showinfo': 0, // 동영상 정보 표시 안 함
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    // 플레이어 준비 완료 시 실행
    function onPlayerReady(event) {
        // 버튼 가시성 토글
        playBtn.classList.remove('hidden');
        pauseBtn.classList.add('hidden');
        // 플레이어를 숨기고 오디오만 듣는 효과를 내려면 아래 주석 해제
        // event.target.getIframe().style.display = 'none';
        event.target.playVideo(); // 동영상 자동 재생
    }

    // 플레이어 상태 변경 시 실행
    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
            playBtn.classList.add('hidden');
            pauseBtn.classList.remove('hidden');
        } else {
            playBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
        }
    }

    // '불러오기' 버튼 클릭 이벤트
    loadBtn.addEventListener('click', () => {
        const url = youtubeLinkInput.value;
        const newVideoId = extractVideoId(url);

        // 유효성 검사
        if (!newVideoId) {
            errorMessage.classList.remove('hidden');
            return;
        }

        errorMessage.classList.add('hidden');
        videoId = newVideoId;
        createPlayer(videoId);
    });

    // '재생' 버튼 클릭 이벤트
    playBtn.addEventListener('click', () => {
        if (player) {
            player.playVideo();
        }
    });

    // '일시정지' 버튼 클릭 이벤트
    pauseBtn.addEventListener('click', () => {
        if (player) {
            player.pauseVideo();
        }
    });

</script>

</body>
</html>

