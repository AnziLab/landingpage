<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µìœ ì§€ì˜ ë¹„ê·¹: ìˆ˜í•™ì  ëª¨ë¸ë§</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    <style>
        body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; margin: 0; padding: 20px; background-color: #f4f6f8; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        
        .description { background-color: #e9ecef; padding: 20px; border-radius: 8px; margin-bottom: 25px; line-height: 1.8; font-size: 1.05em; border-left: 5px solid #007bff; }
        .math-text { font-family: 'Times New Roman', serif; font-style: italic; font-weight: bold; background-color: #fff; padding: 2px 5px; border-radius: 4px; }
        
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px; padding: 25px; border: 1px solid #ddd; border-radius: 12px; background-color: #fafafa; }
        .control-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 10px; font-size: 1.1em; }
        input[type=range] { width: 100%; cursor: pointer; }
        .val-display { color: #007bff; font-weight: bold; margin-left: 10px; }

        .chart-container { position: relative; height: 450px; width: 100%; margin-bottom: 30px; }
        
        .analysis-box { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .result-card { padding: 20px; border-radius: 12px; color: white; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .social-opt { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }
        .individual-eq { background: linear-gradient(135deg, #dc3545 0%, #ff6b6b 100%); }
        
        .result-value { font-size: 2.5em; font-weight: bold; margin: 10px 0; display: block; }
        .math-exp { background: rgba(0,0,0,0.2); padding: 5px 10px; border-radius: 4px; font-family: 'Times New Roman', serif; font-size: 1.1em; display: inline-block; margin-top: 10px; }

        .conclusion { margin-top: 30px; background-color: #fff3cd; border: 1px solid #ffeeba; padding: 20px; border-radius: 8px; color: #856404; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“‰ ê³µìœ ì§€ì˜ ë¹„ê·¹ê³¼ ì´ì°¨í•¨ìˆ˜ ìµœì í™”</h1>
    
    <div class="description">
        <h3>ğŸ“š ìˆ˜í•™ì  ëª¨ë¸ë§ (Textbook Form)</h3>
        <p>
            1. <b>ê°œì¸ì˜ ì´ìµ ($P$)</b>: ì¼ì°¨í•¨ìˆ˜ (ê¸°ìš¸ê¸°ê°€ ìŒìˆ˜)<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="math-text">P(N) = -bN + a</span>
        </p>
        <p>
            2. <b>ì´ ì´ìµ ($T$)</b>: ì´ì°¨í•¨ìˆ˜ (ìœ„ë¡œ ë³¼ë¡í•œ í¬ë¬¼ì„ )<br>
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="math-text">T(N) = N Ã— P = -bNÂ² + aN</span>
        </p>
        <hr style="margin: 15px 0; border: 0; border-top: 1px solid #ccc;">
        <p>
            * <b>N</b>: ê°€ì¶• ëŒë³´ëŠ” ì‚¬ëŒ ìˆ˜ (í•¨ìˆ˜ì˜ $x$ ì—­í• )<br>
            * <b>a</b>: ì´ˆê¸° ìì› (ì ˆí¸) / <b>b</b>: ê³ ê°ˆ ì†ë„ (ê¸°ìš¸ê¸°)
        </p>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>â‘  ìì›ì˜ í’ë¶€í•¨ ($a$): <span id="val_a" class="val-display">100</span></label>
            <input type="range" id="slider_a" min="50" max="200" value="100">
            <small style="color: #666; margin-top: 5px;">$y$ì ˆí¸ ë° ì¼ì°¨í•­ì˜ ê³„ìˆ˜ ì—­í• </small>
        </div>
        <div class="control-group">
            <label>â‘¡ ê³ ê°ˆ ì†ë„ ($b$): <span id="val_b" class="val-display">1</span></label>
            <input type="range" id="slider_b" min="0.5" max="5" step="0.1" value="1">
            <small style="color: #666; margin-top: 5px;">ì´ì°¨í•­ì˜ ê³„ìˆ˜ ($-b$) ì—­í•  (ì ˆëŒ“ê°’ì´ í´ìˆ˜ë¡ í­ì´ ì¢ì•„ì§)</small>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="myChart"></canvas>
    </div>

    <div class="analysis-box">
        <div class="result-card social-opt">
            <h3>ğŸŒŸ ì‚¬íšŒì  ìµœì  (Social Optimum)</h3>
            <div>ì´ì°¨í•¨ìˆ˜ì˜ ê¼­ì§“ì  (ë¯¸ë¶„ê³„ìˆ˜ = 0)</div>
            <span class="result-value" id="res_opt_n">50</span>
            <div class="math-exp">N = a / 2b</div>
            <p>ì´ ì´ìµ ìµœëŒ€: <span id="res_opt_profit">2500</span></p>
        </div>
        <div class="result-card individual-eq">
            <h3>âš ï¸ ê°œì¸ì  ê· í˜• (Equilibrium)</h3>
            <div>ì¼ì°¨í•¨ìˆ˜ì˜ í•´ (P = 0)</div>
            <span class="result-value" id="res_eq_n">100</span>
            <div class="math-exp">N = a / b</div>
            <p>ì´ ì´ìµ: <span id="res_eq_profit">0</span> (ìì› ê³ ê°ˆ)</p>
        </div>
    </div>

    <div class="conclusion">
        <strong>ğŸ“¢ ìˆ˜í•™ì  í•´ì„:</strong><br>
        ì‚¬íšŒ ì „ì²´ì˜ ì´ìµì„ ê·¹ëŒ€í™”í•˜ë ¤ë©´ ê¼­ì§“ì ì¸ <b><span id="txt_opt">50</span>ëª…</b>ì—ì„œ ë©ˆì¶°ì•¼ í•©ë‹ˆë‹¤.<br>
        í•˜ì§€ë§Œ ê°œì¸ì˜ ì´ìµ($P$)ì„ ì¢‡ë‹¤ ë³´ë©´, ê²°êµ­ $x$ì ˆí¸ì¸ <b><span id="txt_eq">100</span>ëª…</b>ê¹Œì§€ ì¸ì›ì´ ëŠ˜ì–´ë‚˜ê²Œ ë˜ì–´ 
        ì´ ì´ìµ($T$)ì´ 0ìœ¼ë¡œ ì¶”ë½í•˜ëŠ” 'ë¹„ê·¹'ì´ ë°œìƒí•©ë‹ˆë‹¤.
    </div>
</div>

<script>
    const ctx = document.getElementById('myChart').getContext('2d');
    let chart;

    const sliderA = document.getElementById('slider_a');
    const sliderB = document.getElementById('slider_b');
    
    // ì´ˆê¸°ê°’
    let a = 100;
    let b = 1;

    function calculateData() {
        const dataN = [];
        const dataTotalProfit = [];
        const dataIndivProfit = [];
        
        // ê·¸ë˜í”„ë¥¼ xì ˆí¸(a/b)ë³´ë‹¤ ì¡°ê¸ˆ ë” ë’¤ê¹Œì§€ ë³´ì—¬ì¤Œ (1.2ë°°)
        const maxN = Math.floor((a / b) * 1.2);

        for (let n = 0; n <= maxN; n++) {
            // êµê³¼ì„œ ë‚´ë¦¼ì°¨ìˆœ í˜•íƒœ: -bN + a
            let p = -b * n + a; 
            
            // êµê³¼ì„œ ë‚´ë¦¼ì°¨ìˆœ í˜•íƒœ: -bN^2 + aN
            let t = -b * (n * n) + a * n;
            
            dataN.push(n);
            dataTotalProfit.push(t);
            dataIndivProfit.push(p);
        }

        return { labels: dataN, total: dataTotalProfit, indiv: dataIndivProfit };
    }

    function updateChart() {
        a = parseFloat(sliderA.value);
        b = parseFloat(sliderB.value);

        document.getElementById('val_a').innerText = a;
        document.getElementById('val_b').innerText = b;

        const data = calculateData();
        const n_opt = Math.round(a / (2 * b)); // ê¼­ì§“ì ì˜ xì¢Œí‘œ (-A/2B ê³µì‹ê³¼ ë™ì¼ì›ë¦¬)
        const n_eq = Math.round(a / b);        // xì ˆí¸

        // ê²°ê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById('res_opt_n').innerText = n_opt + "ëª…";
        document.getElementById('res_opt_profit').innerText = Math.round(-b*(n_opt*n_opt) + a*n_opt);
        
        document.getElementById('res_eq_n').innerText = n_eq + "ëª…";
        document.getElementById('res_eq_profit').innerText = 0;

        document.getElementById('txt_opt').innerText = n_opt;
        document.getElementById('txt_eq').innerText = n_eq;

        if (chart) {
            chart.data.labels = data.labels;
            chart.data.datasets[0].label = `ì´ ì´ìµ (y = -${b}NÂ² + ${a}N)`;
            chart.data.datasets[1].label = `ê°œì¸ ì´ìµ (y = -${b}N + ${a})`;
            chart.data.datasets[0].data = data.total;
            chart.data.datasets[1].data = data.indiv;
            
            // Annotation (ìˆ˜ì§ì„ ) ì—…ë°ì´íŠ¸
            chart.options.plugins.annotation.annotations = {
                line1: {
                    type: 'line',
                    xMin: n_opt, xMax: n_opt,
                    borderColor: 'rgb(40, 167, 69)', borderWidth: 2, borderDash: [5, 5],
                    label: { 
                        content: ['ìµœëŒ€ ì´ìµ ì§€ì ', `N = ${n_opt}`], 
                        display: true, position: 'start', backgroundColor: 'rgba(40, 167, 69, 0.8)',
                        font: { size: 12 }
                    }
                },
                line2: {
                    type: 'line',
                    xMin: n_eq, xMax: n_eq,
                    borderColor: 'rgb(220, 53, 69)', borderWidth: 2, borderDash: [5, 5],
                    label: { 
                        content: ['ìì› ê³ ê°ˆ ì§€ì ', `N = ${n_eq}`], 
                        display: true, position: 'end', backgroundColor: 'rgba(220, 53, 69, 0.8)',
                        font: { size: 12 }
                    }
                }
            };
            chart.update();
        } else {
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: `ì´ ì´ìµ (y = -${b}NÂ² + ${a}N)`,
                        data: data.total,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        yAxisID: 'y',
                        borderWidth: 3,
                        tension: 0.4, // ê³¡ì„ ì„ ë¶€ë“œëŸ½ê²Œ
                        fill: true,
                        pointRadius: 0, // ì  ìˆ¨ê¸°ê¸° (ê¹”ë”í•˜ê²Œ)
                        pointHoverRadius: 6
                    }, {
                        label: `ê°œì¸ ì´ìµ (y = -${b}N + ${a})`,
                        data: data.indiv,
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderDash: [5, 5],
                        yAxisID: 'y1',
                        borderWidth: 2,
                        tension: 0.1,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        x: { 
                            title: { display: true, text: 'ì°¸ê°€ì ìˆ˜ (N)', font: {weight: 'bold'} },
                            grid: { display: false }
                        },
                        y: { 
                            type: 'linear', display: true, position: 'left', 
                            title: { display: true, text: 'ì´ ì´ìµ (ì‚¬íšŒ)', font: {weight: 'bold', color: 'rgba(54, 162, 235, 1)'} } 
                        },
                        y1: { 
                            type: 'linear', display: true, position: 'right', 
                            title: { display: true, text: 'ê°œì¸ ì´ìµ', font: {weight: 'bold', color: 'rgba(255, 159, 64, 1)'} },
                            grid: { drawOnChartArea: false } 
                        }
                    },
                    plugins: {
                        legend: { position: 'top', labels: { usePointStyle: true, font: { size: 13 } } },
                        annotation: { annotations: {} }
                    }
                }
            });
            updateChart(); 
        }
    }

    sliderA.addEventListener('input', updateChart);
    sliderB.addEventListener('input', updateChart);

    // ì´ˆê¸° ì‹¤í–‰
    updateChart();
</script>

</body>
</html>
