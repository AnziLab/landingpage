<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°íƒ€ ìŠ¤ì¼€ì¼ ì—°ìŠµ ë„êµ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fret-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #666;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
        }
        .fret-marker.double {
            width: 6px;
            height: 6px;
        }
        .scale-note {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .scale-note:hover {
            transform: scale(1.1);
        }
        .beat-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
        }
        .beat-indicator.active {
            background: #3b82f6;
            border-color: #1d4ed8;
        }
        .beat-indicator.disabled {
            background: #ef4444;
            border-color: #dc2626;
        }
        .string {
            height: 2px;
            background: #8b5cf6;
            position: relative;
        }
        .fret {
            border-right: 2px solid #666;
            height: 100%;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen text-white p-4">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-6">ğŸ¸ ê¸°íƒ€ ìŠ¤ì¼€ì¼ ì—°ìŠµ ë„êµ¬</h1>
        
        <!-- ì„¤ì • íŒ¨ë„ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- ìŠ¤ì¼€ì¼ ì„¤ì • -->
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
                <h3 class="text-lg font-semibold mb-3">ğŸµ ìŠ¤ì¼€ì¼ ì„¤ì •</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm mb-1">í‚¤ ì„¼í„°</label>
                        <select id="keyCenter" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                            <option value="C">C</option>
                            <option value="C#">C#</option>
                            <option value="D">D</option>
                            <option value="D#">D#</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                            <option value="F#">F#</option>
                            <option value="G">G</option>
                            <option value="G#">G#</option>
                            <option value="A">A</option>
                            <option value="A#">A#</option>
                            <option value="B">B</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm mb-1">ìŠ¤ì¼€ì¼</label>
                        <select id="scaleType" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                            <option value="major">ë©”ì´ì € (ì´ì˜¤ë‹ˆì•ˆ)</option>
                            <option value="dorian">ë„ë¦¬ì•ˆ</option>
                            <option value="phrygian">í”„ë¦¬ì§€ì•ˆ</option>
                            <option value="lydian">ë¦¬ë””ì•ˆ</option>
                            <option value="mixolydian">ë¯¹ì†”ë¦¬ë””ì–¸</option>
                            <option value="minor">ë§ˆì´ë„ˆ (ì—ì˜¬ë¦¬ì•ˆ)</option>
                            <option value="locrian">ë¡œí¬ë¦¬ì•ˆ</option>
                            <option value="wholeTone">í™€í†¤</option>
                            <option value="mixolydianbF9bF13">ë¯¹ì†”ë¦¬ë””ì–¸ â™­9â™­13</option>
                            <option value="naturalMinor">ë‚´ì¶”ëŸ´ ë§ˆì´ë„ˆ</option>
                            <option value="harmonicMinor">í•˜ëª¨ë‹‰ ë§ˆì´ë„ˆ</option>
                            <option value="bebop">ë¹„ë°¥</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ë©”íŠ¸ë¡œë†ˆ ì„¤ì • -->
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
                <h3 class="text-lg font-semibold mb-3">ğŸ¥ ë©”íŠ¸ë¡œë†ˆ</h3>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="block text-sm mb-1">BPM</label>
                            <input type="number" id="bpm" value="120" min="60" max="200" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                        </div>
                        <div>
                            <label class="block text-sm mb-1">ë°•ìí‘œ</label>
                            <select id="timeSignature" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                                <option value="2/2">2/2</option>
                                <option value="3/4">3/4</option>
                                <option value="4/4" selected>4/4</option>
                                <option value="6/8">6/8</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm mb-1">ì¬ìƒ ì˜µì…˜</label>
                        <select id="subdivisions" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                            <option value="quarter">4ë¶„ìŒí‘œ</option>
                            <option value="eighth">8ë¶„ìŒí‘œ</option>
                            <option value="triplet">ì…‹ì‡ë‹¨ìŒí‘œ</option>
                            <option value="tripletGhost">ì…‹ì‡ë‹¨ìŒí‘œ (ê°€ìš´ë° ë¹ˆ)</option>
                            <option value="sixteenth">16ë¶„ìŒí‘œ</option>
                            <option value="sixteenthSparse">16ë¶„ìŒí‘œ (1,4ë°•ë§Œ)</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <button id="metronomePlay" class="flex-1 bg-green-600 hover:bg-green-700 rounded px-3 py-2 text-sm">ì¬ìƒ</button>
                        <button id="metronomeStop" class="flex-1 bg-red-600 hover:bg-red-700 rounded px-3 py-2 text-sm">ì •ì§€</button>
                    </div>
                </div>
            </div>

            <!-- íƒ€ì´ë¨¸ ì„¤ì • -->
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
                <h3 class="text-lg font-semibold mb-3">â±ï¸ ì—°ìŠµ íƒ€ì´ë¨¸</h3>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm mb-1">íƒ€ì´ë¨¸ íƒ€ì…</label>
                        <select id="timerType" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                            <option value="time">ì‹œê°„ íƒ€ì´ë¨¸</option>
                            <option value="bars">ì†Œì ˆ íƒ€ì´ë¨¸</option>
                        </select>
                    </div>
                    <div id="timeTimerDiv">
                        <label class="block text-sm mb-1">ì‹œê°„ (ë¶„)</label>
                        <select id="timeTimer" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                            <option value="5">5ë¶„</option>
                            <option value="10">10ë¶„</option>
                            <option value="15">15ë¶„</option>
                            <option value="20">20ë¶„</option>
                        </select>
                    </div>
                    <div id="barsTimerDiv" style="display: none;">
                        <label class="block text-sm mb-1">ì†Œì ˆ ìˆ˜</label>
                        <input type="number" id="barsTimer" value="32" min="1" max="999" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                    </div>
                    <div class="text-center">
                        <div id="timerDisplay" class="text-2xl font-bold mb-2">5:00</div>
                        <button id="timerStart" class="bg-blue-600 hover:bg-blue-700 rounded px-4 py-2 text-sm">ì‹œì‘</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë°•ì í‘œì‹œê¸° -->
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 mb-6">
            <h3 class="text-lg font-semibold mb-3 text-center">ë°•ì í‘œì‹œê¸°</h3>
            <div id="beatIndicators" class="flex justify-center gap-4"></div>
        </div>

        <!-- ê¸°íƒ€ í”„ë ›ë³´ë“œ -->
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4 text-center">ê¸°íƒ€ í”„ë ›ë³´ë“œ</h3>
            <div class="overflow-x-auto">
                <div id="fretboard" class="relative min-w-[1200px] mx-auto"></div>
            </div>
        </div>

        <!-- ì½”ë“œ ì§„í–‰ ì„¤ì • -->
        <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4">
            <h3 class="text-lg font-semibold mb-3">ğŸ¼ ì½”ë“œ ì§„í–‰ ì—°ìŠµ</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm mb-1">ë°˜ë³µ ë§ˆë”” ìˆ˜</label>
                    <input type="number" id="chordBars" value="4" min="1" max="16" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                </div>
                <div>
                    <label class="block text-sm mb-1">ì½”ë“œ 1</label>
                    <input type="text" id="chord1" value="C" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                </div>
                <div>
                    <label class="block text-sm mb-1">ì½”ë“œ 2</label>
                    <input type="text" id="chord2" value="Am" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                </div>
                <div>
                    <label class="block text-sm mb-1">ì½”ë“œ 3</label>
                    <input type="text" id="chord3" value="F" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm mb-1">ì½”ë“œ 4</label>
                    <input type="text" id="chord4" value="G" class="w-full bg-white/20 rounded px-3 py-2 text-white">
                </div>
                <div class="flex gap-2 items-end">
                    <button id="chordPlay" class="flex-1 bg-purple-600 hover:bg-purple-700 rounded px-4 py-2">ì½”ë“œ ì§„í–‰ ì¬ìƒ</button>
                    <button id="chordStop" class="flex-1 bg-red-600 hover:bg-red-700 rounded px-4 py-2">ì •ì§€</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìŒê³„ ì •ì˜
        const notes = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const stringTuning = ['E', 'A', 'D', 'G', 'B', 'E']; // 6í˜„ë¶€í„° 1í˜„ê¹Œì§€

        // ìŠ¤ì¼€ì¼ íŒ¨í„´ ì •ì˜ (ë°˜ìŒ ê°„ê²©)
        const scalePatterns = {
            major: [0, 2, 4, 5, 7, 9, 11],
            dorian: [0, 2, 3, 5, 7, 9, 10],
            phrygian: [0, 1, 3, 5, 7, 8, 10],
            lydian: [0, 2, 4, 6, 7, 9, 11],
            mixolydian: [0, 2, 4, 5, 7, 9, 10],
            minor: [0, 2, 3, 5, 7, 8, 10],
            locrian: [0, 1, 3, 5, 6, 8, 10],
            wholeTone: [0, 2, 4, 6, 8, 10],
            mixolydianbF9bF13: [0, 1, 4, 5, 7, 8, 10],
            naturalMinor: [0, 2, 3, 5, 7, 8, 10],
            harmonicMinor: [0, 2, 3, 5, 7, 8, 11],
            bebop: [0, 2, 4, 5, 7, 9, 10, 11]
        };

        // ìŠ¤ì¼€ì¼ ë„ìˆ˜ í‘œê¸°
        const scaleIntervals = {
            major: ['R', '2', '3', '4', '5', '6', '7'],
            dorian: ['R', '2', 'b3', '4', '5', '6', 'b7'],
            phrygian: ['R', 'b2', 'b3', '4', '5', 'b6', 'b7'],
            lydian: ['R', '2', '3', '#4', '5', '6', '7'],
            mixolydian: ['R', '2', '3', '4', '5', '6', 'b7'],
            minor: ['R', '2', 'b3', '4', '5', 'b6', 'b7'],
            locrian: ['R', 'b2', 'b3', '4', 'b5', 'b6', 'b7'],
            wholeTone: ['R', '2', '3', '#4', '#5', '#6'],
            mixolydianbF9bF13: ['R', 'b2', '3', '4', '5', 'b6', 'b7'],
            naturalMinor: ['R', '2', 'b3', '4', '5', 'b6', 'b7'],
            harmonicMinor: ['R', '2', 'b3', '4', '5', 'b6', '7'],
            bebop: ['R', '2', '3', '4', '5', '6', 'b7', '7']
        };

        // ìƒ‰ìƒ ì •ì˜
        const intervalColors = {
            'R': '#ef4444',     // ë¹¨ê°• (ë£¨íŠ¸)
            '2': '#f97316',     // ì£¼í™©
            'b2': '#f59e0b',    // ë…¸ë‘-ì£¼í™©
            '3': '#eab308',     // ë…¸ë‘
            'b3': '#84cc16',    // ì—°ë‘
            '4': '#22c55e',     // ì´ˆë¡
            '#4': '#10b981',    // ì²­ë¡
            '5': '#06b6d4',     // í•˜ëŠ˜
            'b5': '#0ea5e9',    // íŒŒë‘
            '6': '#3b82f6',     // ì§„íŒŒë‘
            'b6': '#6366f1',    // ë‚¨ë³´ë¼
            '7': '#8b5cf6',     // ë³´ë¼
            'b7': '#a855f7',    // ì§„ë³´ë¼
            '#5': '#d946ef',    // ìì£¼
            '#6': '#ec4899'     // ë¶„í™
        };

        let metronomeInterval = null;
        let chordInterval = null;
        let timerInterval = null;
        let currentBeat = 0;
        let beatCount = 4;
        let beatStates = [true, true, true, true];
        let audioContext = null;
        let timerSeconds = 0;
        let timerBars = 0;
        let currentChordBar = 0;

        // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // ë¹„í”„ ì†Œë¦¬ ìƒì„±
        function playBeep(frequency = 800, duration = 100) {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        // ë² ì´ìŠ¤ ì†Œë¦¬ ìƒì„±
        function playBass(frequency = 82, duration = 500) {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sawtooth';
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
        }

        // í”„ë ›ë³´ë“œ ìƒì„±
        function createFretboard() {
            const fretboard = document.getElementById('fretboard');
            fretboard.innerHTML = '';
            
            const fretboardWidth = 1200;
            const fretboardHeight = 200;
            const fretWidth = fretboardWidth / 23; // 0í”„ë › + 22í”„ë ›
            
            fretboard.style.width = fretboardWidth + 'px';
            fretboard.style.height = fretboardHeight + 'px';
            
            // í˜„ ê·¸ë¦¬ê¸°
            for (let string = 0; string < 6; string++) {
                const stringEl = document.createElement('div');
                stringEl.className = 'string';
                stringEl.style.position = 'absolute';
                stringEl.style.top = (30 + string * 25) + 'px';
                stringEl.style.left = '0px';
                stringEl.style.width = '100%';
                fretboard.appendChild(stringEl);
            }
            
            // í”„ë › ê·¸ë¦¬ê¸°
            for (let fret = 1; fret <= 22; fret++) {
                const fretEl = document.createElement('div');
                fretEl.className = 'fret';
                fretEl.style.position = 'absolute';
                fretEl.style.left = (fret * fretWidth) + 'px';
                fretEl.style.top = '20px';
                fretEl.style.height = '160px';
                fretboard.appendChild(fretEl);
                
                // í”„ë › ë§ˆì»¤ (ì¸ë ˆì´)
                if ([3, 5, 7, 9, 15, 17, 19].includes(fret)) {
                    const marker = document.createElement('div');
                    marker.className = 'fret-marker';
                    marker.style.left = (fret * fretWidth - fretWidth/2 - 4) + 'px';
                    fretboard.appendChild(marker);
                } else if (fret === 12) {
                    // 12í”„ë ›ì€ ë‘ ê°œì˜ ë§ˆì»¤
                    const marker1 = document.createElement('div');
                    marker1.className = 'fret-marker double';
                    marker1.style.left = (fret * fretWidth - fretWidth/2 - 3) + 'px';
                    marker1.style.top = '40%';
                    fretboard.appendChild(marker1);
                    
                    const marker2 = document.createElement('div');
                    marker2.className = 'fret-marker double';
                    marker2.style.left = (fret * fretWidth - fretWidth/2 - 3) + 'px';
                    marker2.style.top = '60%';
                    fretboard.appendChild(marker2);
                }
            }
            
            updateScale();
        }

        // ìŒí‘œ ì¸ë±ìŠ¤ ê³„ì‚°
        function getNoteIndex(note) {
            return notes.indexOf(note);
        }

        // í”„ë ›ì˜ ìŒí‘œ ê³„ì‚°
        function getFretNote(stringIndex, fret) {
            const openNote = stringTuning[stringIndex];
            const openNoteIndex = getNoteIndex(openNote);
            return notes[(openNoteIndex + fret) % 12];
        }

        // ìŠ¤ì¼€ì¼ ì—…ë°ì´íŠ¸
        function updateScale() {
            const keyCenter = document.getElementById('keyCenter').value;
            const scaleType = document.getElementById('scaleType').value;
            const fretboard = document.getElementById('fretboard');
            
            // ê¸°ì¡´ ìŠ¤ì¼€ì¼ ë…¸íŠ¸ ì œê±°
            const existingNotes = fretboard.querySelectorAll('.scale-note');
            existingNotes.forEach(note => note.remove());
            
            const pattern = scalePatterns[scaleType];
            const intervals = scaleIntervals[scaleType];
            const keyCenterIndex = getNoteIndex(keyCenter);
            const fretWidth = 1200 / 23;
            
            // ìŠ¤ì¼€ì¼ ë…¸íŠ¸ë“¤ ê³„ì‚°
            const scaleNotes = pattern.map(interval => notes[(keyCenterIndex + interval) % 12]);
            
            // ê° í˜„ê³¼ í”„ë ›ì— ëŒ€í•´ ìŠ¤ì¼€ì¼ ë…¸íŠ¸ í‘œì‹œ
            for (let string = 0; string < 6; string++) {
                for (let fret = 0; fret <= 22; fret++) {
                    const fretNote = getFretNote(string, fret);
                    const scaleIndex = scaleNotes.indexOf(fretNote);
                    
                    if (scaleIndex !== -1) {
                        const noteEl = document.createElement('div');
                        noteEl.className = 'scale-note';
                        noteEl.textContent = intervals[scaleIndex];
                        noteEl.style.position = 'absolute';
                        noteEl.style.left = (fret * fretWidth - 12 + (fret === 0 ? fretWidth/2 : 0)) + 'px';
                        noteEl.style.top = (18 + string * 25) + 'px';
                        noteEl.style.backgroundColor = intervalColors[intervals[scaleIndex]];
                        noteEl.style.zIndex = '10';
                        
                        noteEl.addEventListener('click', () => {
                            // ìŒí‘œ í´ë¦­ ì‹œ ì†Œë¦¬ ì¬ìƒ (ì˜µì…˜)
                            const frequency = 82.41 * Math.pow(2, (keyCenterIndex + pattern[scaleIndex]) / 12);
                            playBass(frequency, 300);
                        });
                        
                        fretboard.appendChild(noteEl);
                    }
                }
            }
        }

        // ë°•ì í‘œì‹œê¸° ì—…ë°ì´íŠ¸
        function updateBeatIndicators() {
            const timeSignature = document.getElementById('timeSignature').value;
            const [numerator] = timeSignature.split('/').map(Number);
            beatCount = numerator;
            
            const container = document.getElementById('beatIndicators');
            container.innerHTML = '';
            
            beatStates = new Array(beatCount).fill(true);
            
            for (let i = 0; i < beatCount; i++) {
                const indicator = document.createElement('div');
                indicator.className = 'beat-indicator';
                indicator.textContent = i + 1;
                indicator.addEventListener('click', () => {
                    beatStates[i] = !beatStates[i];
                    indicator.classList.toggle('disabled', !beatStates[i]);
                });
                container.appendChild(indicator);
            }
        }

        // ë©”íŠ¸ë¡œë†ˆ ì¬ìƒ
        function startMetronome() {
            if (metronomeInterval) return;
            
            initAudio();
            const bpm = parseInt(document.getElementById('bpm').value);
            const subdivisions = document.getElementById('subdivisions').value;
            
            let interval;
            let pattern;
            
            switch (subdivisions) {
                case 'quarter':
                    interval = 60000 / bpm;
                    pattern = [true];
                    break;
                case 'eighth':
                    interval = 60000 / bpm / 2;
                    pattern = [true, false];
                    break;
                case 'triplet':
                    interval = 60000 / bpm / 3;
                    pattern = [true, false, false];
                    break;
                case 'tripletGhost':
                    interval = 60000 / bpm / 3;
                    pattern = [true, false, true];
                    break;
                case 'sixteenth':
                    interval = 60000 / bpm / 4;
                    pattern = [true, false, false, false];
                    break;
                case 'sixteenthSparse':
                    interval = 60000 / bpm / 4;
                    pattern = [true, false, false, true];
                    break;
            }
            
            let subBeat = 0;
            
            metronomeInterval = setInterval(() => {
                const indicators = document.querySelectorAll('.beat-indicator');
                
                // ì´ì „ í‘œì‹œ ì œê±°
                indicators.forEach(ind => ind.classList.remove('active'));
                
                // í˜„ì¬ ë°•ì í‘œì‹œ
                if (pattern[subBeat % pattern.length] && beatStates[currentBeat]) {
                    indicators[currentBeat].classList.add('active');
                    playBeep(currentBeat === 0 ? 1000 : 800, 50);
                }
                
                subBeat++;
                if (subBeat % pattern.length === 0) {
                    currentBeat = (currentBeat + 1) % beatCount;
                }
            }, interval);
        }

        // ë©”íŠ¸ë¡œë†ˆ ì •ì§€
        function stopMetronome() {
            if (metronomeInterval) {
                clearInterval(metronomeInterval);
                metronomeInterval = null;
                currentBeat = 0;
                
                const indicators = document.querySelectorAll('.beat-indicator');
                indicators.forEach(ind => ind.classList.remove('active'));
            }
        }

        // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
        function updateTimerDisplay() {
            const timerType = document.getElementById('timerType').value;
            const display = document.getElementById('timerDisplay');
            
            if (timerType === 'time') {
                const minutes = Math.floor(timerSeconds / 60);
                const seconds = timerSeconds % 60;
                display.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else {
                display.textContent = `${timerBars} ì†Œì ˆ`;
            }
        }

        // íƒ€ì´ë¨¸ ì‹œì‘
        function startTimer() {
            const timerType = document.getElementById('timerType').value;
            
            if (timerType === 'time') {
                timerSeconds = parseInt(document.getElementById('timeTimer').value) * 60;
            } else {
                timerBars = parseInt(document.getElementById('barsTimer').value);
            }
            
            updateTimerDisplay();
            
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                if (timerType === 'time') {
                    timerSeconds--;
                    if (timerSeconds <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        playBeep(1200, 500); // ì™„ë£Œ ì‹ í˜¸
                    }
                } else {
                    // ì†Œì ˆ íƒ€ì´ë¨¸ëŠ” ë©”íŠ¸ë¡œë†ˆê³¼ ì—°ë™í•˜ì—¬ ê³„ì‚°
                    const bpm = parseInt(document.getElementById('bpm').value);
                    const timeSignature = document.getElementById('timeSignature').value;
                    const [numerator] = timeSignature.split('/').map(Number);
                    const barDuration = (60000 / bpm) * numerator;
                    
                    // ê°„ë‹¨íˆ 1ì´ˆë§ˆë‹¤ ì²´í¬
                    if (metronomeInterval && currentBeat === 0) {
                        timerBars--;
                        if (timerBars <= 0) {
                            clearInterval(timerInterval);
                            timerInterval = null;
                            playBeep(1200, 500);
                        }
                    }
                }
                updateTimerDisplay();
            }, 1000);
        }

        // ì½”ë“œ ì§„í–‰ ì¬ìƒ
        function startChordProgression() {
            if (chordInterval) return;
            
            initAudio();
            const bpm = parseInt(document.getElementById('bpm').value);
            const timeSignature = document.getElementById('timeSignature').value;
            const [numerator] = timeSignature.split('/').map(Number);
            const barDuration = (60000 / bpm) * numerator;
            
            const chords = [
                document.getElementById('chord1').value,
                document.getElementById('chord2').value,
                document.getElementById('chord3').value,
                document.getElementById('chord4').value
            ];
            
            currentChordBar = 0;
            
            // ì²« ì½”ë“œ ì¬ìƒ
            playChordBass(chords[0]);
            
            chordInterval = setInterval(() => {
                currentChordBar = (currentChordBar + 1) % chords.length;
                playChordBass(chords[currentChordBar]);
            }, barDuration);
        }

        // ì½”ë“œ ë² ì´ìŠ¤ ì¬ìƒ
        function playChordBass(chord) {
            // ê°„ë‹¨í•œ ì½”ë“œ-ë² ì´ìŠ¤ ë§¤í•‘
            const bassNotes = {
                'C': 65.41, 'C#': 69.30, 'Db': 69.30, 'D': 73.42, 'D#': 77.78, 'Eb': 77.78,
                'E': 82.41, 'F': 87.31, 'F#': 92.50, 'Gb': 92.50, 'G': 98.00, 'G#': 103.83, 'Ab': 103.83,
                'A': 110.00, 'A#': 116.54, 'Bb': 116.54, 'B': 123.47,
                'Am': 110.00, 'Bm': 123.47, 'Cm': 65.41, 'Dm': 73.42, 'Em': 82.41, 'Fm': 87.31, 'Gm': 98.00
            };
            
            const frequency = bassNotes[chord] || 82.41;
            playBass(frequency, 800);
        }

        // ì½”ë“œ ì§„í–‰ ì •ì§€
        function stopChordProgression() {
            if (chordInterval) {
                clearInterval(chordInterval);
                chordInterval = null;
                currentChordBar = 0;
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', () => {
            createFretboard();
            updateBeatIndicators();
            updateTimerDisplay();
            
            // ìŠ¤ì¼€ì¼ ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('keyCenter').addEventListener('change', updateScale);
            document.getElementById('scaleType').addEventListener('change', updateScale);
            
            // ë°•ìí‘œ ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('timeSignature').addEventListener('change', updateBeatIndicators);
            
            // ë©”íŠ¸ë¡œë†ˆ ë²„íŠ¼
            document.getElementById('metronomePlay').addEventListener('click', startMetronome);
            document.getElementById('metronomeStop').addEventListener('click', stopMetronome);
            
            // íƒ€ì´ë¨¸ ì„¤ì •
            document.getElementById('timerType').addEventListener('change', (e) => {
                const timeDiv = document.getElementById('timeTimerDiv');
                const barsDiv = document.getElementById('barsTimerDiv');
                
                if (e.target.value === 'time') {
                    timeDiv.style.display = 'block';
                    barsDiv.style.display = 'none';
                } else {
                    timeDiv.style.display = 'none';
                    barsDiv.style.display = 'block';
                }
                updateTimerDisplay();
            });
            
            document.getElementById('timeTimer').addEventListener('change', updateTimerDisplay);
            document.getElementById('barsTimer').addEventListener('change', updateTimerDisplay);
            document.getElementById('timerStart').addEventListener('click', startTimer);
            
            // ì½”ë“œ ì§„í–‰ ë²„íŠ¼
            document.getElementById('chordPlay').addEventListener('click', startChordProgression);
            document.getElementById('chordStop').addEventListener('click', stopChordProgression);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9726f600640fbcc4',t:'MTc1NTc0NjA3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
